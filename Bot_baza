import telebot
from telebot.types import ChatPermissions

TOKEN = '–¢–û–ö–ï–ù'
bot = telebot.TeleBot(TOKEN)
user_db = {}

@bot.message_handler(func=lambda m: True, content_types=['text'])
def handle_all(message):
    if message.from_user.username:
        user_db[message.from_user.username.lower()] = message.from_user.id
    
    if message.text.startswith('/setrole'):
        parts = message.text.split()
        if len(parts) < 3:
            return bot.reply_to(message, "–ò—Å–ø–æ–ª—å–∑—É–π: /setrole @username role")

        username = parts[1].replace('@', '').lower()
        role = parts[2].lower()
        target_id = user_db.get(username)

        if not target_id:
            return bot.reply_to(message, f"—Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç {username} –Ω–µ–±—ã–ª–æ. –ü—É—Å—Ç—å –æ–Ω —á—Ç–æ-—Ç–æ –Ω–∞–ø–∏—à–µ—Ç!")

        try:
            if role == 'admin':
                bot.promote_chat_member(message.chat.id, target_id, 
                    can_manage_chat=True, can_delete_messages=True, can_restrict_members=True)
                bot.set_chat_administrator_custom_title(message.chat.id, target_id, "–ê–¥–º–∏–Ω")
                bot.reply_to(message, f"‚ö°Ô∏è @{username} —Ç–µ–ø–µ—Ä—å Admin!")

            elif role == 'mute':
                bot.restrict_chat_member(message.chat.id, target_id, 
                    permissions=ChatPermissions(can_send_messages=False))
                bot.reply_to(message, f"üîá @{username} –≤ –º—É—Ç–µ.")

            elif role == 'member':
                bot.promote_chat_member(message.chat.id, target_id, can_manage_chat=False)
                bot.restrict_chat_member(message.chat.id, target_id, 
                    permissions=ChatPermissions(can_send_messages=True, can_send_media_messages=True))
                bot.reply_to(message, f"‚úÖ @{username} —É—á–∞—Å—Ç–Ω–∏–∫.")

        except Exception as e:
            bot.reply_to(message, f"–û—à–∏–±–∫–∞: {e}. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –±–æ—Ç ‚Äî –∞–¥–º–∏–Ω —Å –ø—Ä–∞–≤–æ–º –Ω–∞–∑–Ω–∞—á–∞—Ç—å –¥—Ä—É–≥–∏—Ö!")

bot.polling()
