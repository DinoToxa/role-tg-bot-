import telebot
import re
import time
from telebot.types import ChatPermissions

TOKEN = "token"
bot = telebot.TeleBot(TOKEN)

# –ü—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –ø–ª–æ—Ö–∏—Ö —Å–ª–æ–≤
BAD_WORD_ROOTS = [
    # –ö–æ—Ä–Ω–∏-–∞–Ω–∞—Ç–æ–º–∏–∑–º—ã
    '—Ö—É[–∏–π–µ—ë—è—é]', '–ø–∏–∑–¥', '–µ–±[–∞–æ—ë–ª–Ω]', '–±–ª—è[–¥—Ç]',
    # –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ
    '—Ö–µ—Ä', '–º—É–¥[—ë–µ–æ–∞]', '–º–∞–Ω–¥–∞', '–≥[–æ–∞]–Ω–¥–æ–Ω', '–∑–∞–ª—É–ø',
    # –ñ–µ—Å—Ç–∫–∏–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –ø–æ –≥—Ä—É–ø–ø–∞–º (–ø—Ä–∏–º–µ—Ä—ã)
    '—É[—ë–æ]–±–ª', '–¥[–µ—ë]–±[–∏—ñ]–ª', '–¥[–∞–æ]—É–Ω', '–∫—Ä[–µ—ë]—Ç–∏–Ω', '–ø—Ä[–∏–µ]–¥[–∞–æ]–∫',
    '—Å–≤[–∞–æ]–ª[–∞–æ]—á', '—Å–∫[–∞–æ]—Ç[–∏–µ]–Ω', '–≥–Ω–∏–¥', '–≤[—ã—ñ]—Ä–æ–¥[–∞–æ]–∫'
]

# –°–ü–ò–°–û–ö –ü–û–õ–ù–´–• –°–õ–û–í (–¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)
FULL_BAD_WORDS = [
    '—Ö—É–π–ª–æ', '–ø–∏–¥–æ—Ä', '–ø–∏–¥–æ—Ä–∞—Å', '–ø–µ–¥–∏–∫', '–≥–æ–º–∏–∫', '–Ω–∏–≥–µ—Ä', '–Ω–∏–≥–≥–µ—Ä',
    '–≥[–∞–æ]–≤–Ω', '–¥–µ—Ä—å–º', '—à–ª—é—Ö', '–ø—Ä[–∞–æ]—Å—Ç[–∏–µ]—Ç', '—á–º[–∞–æ]', '–∂[–∏–µ]—Ä–¥',
    '–±–æ–ª–≤–∞–Ω', '—Å–∫–æ—Ç–∏–Ω–∞', '—Ç–≤–∞—Ä—å', '–∏–¥–∏–æ—Ç', '–¥—É—Ä–∞–∫', '–∫—Ä–µ—Ç–∏–Ω', '–¥–µ–±–∏–ª', '–¥–∞—É–Ω', '—É–±–ª—é–¥–æ–∫'
]

# –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
roots_pattern = re.compile('|'.join(BAD_WORD_ROOTS), re.I)
full_words_pattern = re.compile(r'\b(' + '|'.join(FULL_BAD_WORDS) + r')\b', re.I)

def contains_bad_words(text):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –º–∞—Ç–∞ –ø–æ –∫–æ—Ä–Ω—è–º –∏ –ø–æ–ª–Ω—ã–º —Å–ª–æ–≤–∞–º."""
    if not text:
        return False
    if roots_pattern.search(text):
        return True
    if full_words_pattern.search(text):
        return True
    return False

@bot.message_handler(func=lambda message: True)
def check_message(message):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –º–∞—Ç—ã
    text = message.text if message.text else ""
    
    if contains_bad_words(text):
        try:
            # 1. –í—Å–µ–≥–¥–∞ —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º —á–∞—Ç–µ)
            bot.delete_message(message.chat.id, message.message_id)
            
            # 2. –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–¥–∞—Ç—å –º—É—Ç –¢–û–õ–¨–ö–û –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞—Ö
            chat_type = message.chat.type
            
            if chat_type in ['group', 'supergroup']:
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞ –ª–∏ —ç—Ç–æ
                    chat_info = bot.get_chat(message.chat.id)
                    
                    # –ï—Å–ª–∏ —á–∞—Ç - —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞, –≤—ã–¥–∞–µ–º –º—É—Ç
                    if hasattr(chat_info, 'is_forum') or chat_info.type == 'supergroup':
                        bot.restrict_chat_member(
                            message.chat.id,
                            message.from_user.id,
                            until_date=int(time.time()) + 600,  # 10 –º–∏–Ω—É—Ç
                            permissions=ChatPermissions(
                                can_send_messages=False,
                                can_send_media_messages=False,
                                can_send_other_messages=False,
                                can_add_web_page_previews=False
                            )
                        )
                        warning_text = f"üîá @{message.from_user.username or message.from_user.id} –ø–æ–ª—É—á–∏–ª –º—É—Ç –Ω–∞ 10 –º–∏–Ω—É—Ç!"
                        bot.send_message(message.chat.id, warning_text)
                    else:
                        # –û–±—ã—á–Ω–∞—è –≥—Ä—É–ø–ø–∞ - —Ç–æ–ª—å–∫–æ —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                        warning_text = f"‚ö†Ô∏è @{message.from_user.username or message.from_user.id}, –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª!"
                        bot.send_message(message.chat.id, warning_text)
                        
                except Exception as e:
                    # –ï—Å–ª–∏ –Ω–µ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞ –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤
                    warning_text = f"‚ö†Ô∏è @{message.from_user.username or message.from_user.id}, –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!"
                    bot.send_message(message.chat.id, warning_text)
            else:
                # –õ–∏—á–Ω—ã–π —á–∞—Ç –∏–ª–∏ –∫–∞–Ω–∞–ª
                warning_text = "‚ö†Ô∏è –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞!"
                bot.send_message(message.chat.id, warning_text)
                
        except Exception as e:
            # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
            
            # –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            try:
                if "message to delete not found" in str(e):
                    bot.send_message(message.chat.id, "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (—É–∂–µ —É–¥–∞–ª–µ–Ω–æ?)")
                elif "CHAT_ADMIN_REQUIRED" in str(e):
                    bot.send_message(message.chat.id, "‚ö†Ô∏è –£ –±–æ—Ç–∞ –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!")
                else:
                    bot.send_message(message.chat.id, f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {str(e)[:100]}")
            except:
                pass  # –ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å - –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º

if __name__ == '__main__':
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π...")
    bot.polling(none_stop=True, interval=0)
